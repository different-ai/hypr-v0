{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/benjaminshafii/git/hypr-v0/packages/request-invoice-web/packages/request-invoice-web/src/components/InvoiceDetails.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { Types } from '@requestnetwork/request-client.js';\nimport { RequestLogicTypes } from '@requestnetwork/types';\n// Import required dependencies\nimport { providers } from 'ethers';\nimport { \n  payRequest,\n  hasSufficientFunds,\n  hasErc20Approval,\n  approveErc20\n} from '@requestnetwork/payment-processor';\n\ninterface InvoiceDetailsProps {\n  requestData: Types.IRequestData;\n  requestId: string;\n}\n\nexport default function InvoiceDetails({ requestData, requestId }: InvoiceDetailsProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handlePayment = async () => {\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      // Connect to wallet\n      if (!window.ethereum) {\n        throw new Error('Please install MetaMask to make payments');\n      }\n\n      const provider = new providers.Web3Provider(window.ethereum);\n      await provider.send('eth_requestAccounts', []);\n      const signer = provider.getSigner();\n      const address = await signer.getAddress();\n\n      // Check funds\n      const hasFunds = await hasSufficientFunds({\n        request: requestData,\n        address,\n        providerOptions: {\n          provider\n        }\n      });\n\n      if (!hasFunds) {\n        throw new Error('Insufficient funds');\n      }\n\n      // Check and handle ERC20 approval if needed\n      const hasApproval = await hasErc20Approval(\n        requestData,\n        address,\n        provider\n      );\n\n      if (!hasApproval) {\n        const approvalTx = await approveErc20(\n          requestData,\n          signer\n        );\n        await approvalTx.wait(2);\n      }\n\n      // Process payment\n      const paymentTx = await payRequest(\n        requestData,\n        signer\n      );\n      await paymentTx.wait(2);\n\n      // Refresh page after payment\n      window.location.reload();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Payment failed');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const formatAmount = (amount: RequestLogicTypes.Amount) => {\n    if (!amount) return '0';\n    // Convert amount to string and handle decimals\n    return (BigInt(amount.toString()) / BigInt(1e18)).toString();\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto\">\n      <h1 className=\"text-2xl font-bold mb-6\">Invoice Details</h1>\n      \n      <div className=\"space-y-4\">\n        <div>\n          <h2 className=\"text-lg font-semibold\">Request ID</h2>\n          <p className=\"text-gray-600\">{requestId}</p>\n        </div>\n\n        <div>\n          <h2 className=\"text-lg font-semibold\">Amount</h2>\n          <p className=\"text-gray-600\">\n            {formatAmount(requestData.expectedAmount)} {requestData.currencyInfo?.type || 'Unknown'}\n          </p>\n        </div>\n\n        <div>\n          <h2 className=\"text-lg font-semibold\">Status</h2>\n          <p className=\"text-gray-600\">\n            {BigInt(requestData.balance?.balance?.toString() || '0') >= BigInt(requestData.expectedAmount?.toString() || '0')\n              ? 'Paid'\n              : 'Pending'}\n          </p>\n        </div>\n\n        {requestData.contentData && (\n          <div>\n            <h2 className=\"text-lg font-semibold\">Details</h2>\n            <pre className=\"text-gray-600 whitespace-pre-wrap\">\n              {JSON.stringify(requestData.contentData, null, 2)}\n            </pre>\n          </div>\n        )}\n\n\n        {Number(requestData.balance?.balance || '0') < Number(requestData.expectedAmount) && (\n          <div className=\"mt-8\">\n            <button\n              onClick={handlePayment}\n              disabled={isLoading}\n              className={`w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors\n                ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}\n            >\n              {isLoading ? 'Processing...' : 'Pay Invoice'}\n            </button>\n            {error && (\n              <p className=\"mt-2 text-red-600 text-sm\">{error}</p>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}